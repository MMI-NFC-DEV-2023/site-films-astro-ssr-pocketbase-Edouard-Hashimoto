---
import { Debug } from "astro:components";
import Layout from "../../layouts/Layout.astro";
import type { PersonnesResponse, FilmsResponse, RolesResponse } from "../../pocketbase-typegen";

export const prerender = false;

const listPersonnes = await Astro.locals.pb.collection<PersonnesResponse<{films_via_producteur: FilmsResponse[];
    films_via_scenariste: FilmsResponse[]; roles_via_acteur?: RolesResponse[];
}>>("personnes").getFullList({ expand: "films_via_producteur, films_via_scenariste, roles_via_acteur" });

---

<!-- <pre>{JSON.stringify(personnes, null, 2)}</pre> -->
 <Layout>
    {listPersonnes.map((personne) => (
        <div>
            <h2>
                {personne.nom} {personne.prenom}
            </h2>
             {personne.expand?.films_via_producteur && <p>Les films où il est producteur :{" "}
                {personne.expand?.films_via_producteur?.map((film) => (
                    <span>{film.titre }</span>
                ))}
            </p> }
            {personne.expand?.films_via_scenariste && <p>Les films où il est scénariste :{" "}
                {personne.expand?.films_via_scenariste?.map((film) => (
                    <span>{film.titre }</span>
                ))}
            </p> }
            {personne.expand?.roles_via_acteur && <p>Les rôles :{" "}
                {personne.expand?.roles_via_acteur?.map((film) => (
                    <span>{film.nom_role + ", " + "Joué par : " + personne.nom }</span>
                ))}
            </p> }
        </div>
    ))}
    <Debug {listPersonnes} />
</Layout>