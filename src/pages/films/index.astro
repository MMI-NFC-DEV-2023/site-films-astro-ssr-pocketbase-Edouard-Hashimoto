---
import { Debug } from "astro:components";
import Layout from "../../layouts/Layout.astro";
import type { FilmsResponse, PersonnesResponse, RolesResponse } from "../../pocketbase-typegen";
type Response = FilmsResponse<{producteur : PersonnesResponse; scenariste: PersonnesResponse[]; role: RolesResponse<{acteur : PersonnesResponse}>[]}>;
export const prerender = false;

const films = await Astro.locals.pb.collection<Response>("films").getFullList({expand: "producteur, scenariste, role.acteur"});

---

<!-- <pre>{JSON.stringify(personnes, null, 2)}</pre> -->
 <Layout>
    {films.map(film => <div>
        <h2>Film : {film.titre}</h2>
        <p>Année : {film.date_sortie}</p>
        <p>Producteur : {film.expand?.producteur.prenom} {film.expand?.producteur.nom}</p>
        <p>Scénariste : {film.expand?.scenariste.map(s => <span> {s.nom} {s.prenom + " "}</span>)}</p>
        <p>Durée : {film.duree}</p>
        <p>Rôles : {film.expand?.role.map(r => <span>{r.nom_role + " "}</span><span>Joué par : {r.expand?.acteur.nom}</span>)}</p>
    </div>)}
    <Debug {films} />
</Layout>